---
title: "Contexto"
date: 2021-02-16T06:35:20-03:00
draft: false
---

- Ontem eu conversei com o @rdutenke, que me tirou varias duvidas sobre o `get_next_line`:
  _Agora eu sei que o read avanca a poicao no file descriptor automaticamente._
  O "pulo do gato" para este projeto eh utilizar um ponteiro statico como buffer, allocado com `BUFFER_SIZE + 1`: assim podemos passa-lo para `read` e tratar os differentes casos:

1. Se o buffer lido nao tem `'\n'` ou `EOF`, concatenamos com o buffer anterior e chamamos `read` novamente.
2. Se o buffer lido tem `'\n'` concatenamos com o buffer anterior ate o `'\n'`.
3. Se o buffer lido tem `EOF` concatenamos com o buffer anterior ate o `EOF`.
4. Finalmente temos que apontar o ponteiro `line` passado para uma string allocada que contenha a linha inteira sem o `'\n'`. Depois liberamos a memoria allocada nas strings intermediarias e retornamos `1` ou `0` para `'\n'` ou `EOF` respectivamente.
5. Se os parametros tem algum problema (`BUFFER_SIZE <= 0`), ou em alguma dessas operacaoes nao conseguimos allocar memoria, liberamos toda a memoria allocada e retornamos `-1`.

- Hoje nao vou conseguir codar muito pelo trabalho e o CFC.
